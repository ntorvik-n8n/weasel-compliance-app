# Story 3.4: Display Risk Level Indicators

## Story Overview

**Story ID:** 3.4
**Epic:** Epic 3 - AI Compliance Analysis Engine
**Priority:** P1 (High)
**Status:** âœ… Complete (Minor issue noted)
**Story Points:** 2
**Sprint:** Sprint 4 (Epic 3)

## User Story
**As a** compliance officer
**I want** to see a visual indicator of the risk level for each call in the main file list
**So that** I can immediately identify and prioritize high-risk calls for review.

## Technical Design
1.  **Retrieve Risk Score:**
    -   The main file list API (`app/api/files/route.ts`) needs to be enhanced.
    -   When fetching the list of files, it should now also look for the `riskScore` in each file's metadata (this will be added by the analysis process).
    -   The `riskScore` (a number from 0-10) should be added to the `FileMetadata` object returned to the client.
2.  **Define Risk Levels:**
    -   Create a utility function `getRiskLevel(score: number): 'low' | 'medium' | 'high' | 'critical'`.
    -   Define the score ranges:
        -   0-3: low
        -   3-6: medium
        -   6-8: high
        -   8-10: critical
3.  **Create a `RiskIndicator` Component:**
    -   Create a new component: `components/ui/RiskIndicator.tsx`.
    -   This component will take a `riskLevel` as a prop.
    -   It will display a colored dot or icon and the level's text (e.g., a red dot next to "Critical").
        -   Low: Green
        -   Medium: Yellow
        -   High: Orange
        -   Critical: Red
4.  **Integrate into File List:**
    -   Add a new "Risk Level" column to the `EnhancedFileList.tsx` component.
    -   Use the new `RiskIndicator` component to render the cell for this column.
    -   Make the column sortable.

## Acceptance Criteria
- [x] The `GET /api/files` endpoint includes the `riskScore` in its response for each analyzed file.
- [x] A new `RiskIndicator` component is created and displays different colors based on the risk level.
- [x] The `EnhancedFileList` has a new "Risk Level" column.
- [x] Analyzed calls correctly display their risk level in the new column.
- [x] The "Risk Level" column is sortable.

---
*Architect: Winston*

---
## Dev Agent Record

**Completed by:** James (Full Stack Developer)
**Date:** 2025-10-11

**Summary of Work:**
- Updated the `GET /api/files` endpoint to include the `riskScore` from blob metadata in the response.
- Added the `riskScore` field to the `FileMetadata` type definition.
- Created a `lib/riskLevels.ts` utility to convert numerical scores into categorical risk levels.
- Built a new `RiskIndicator` UI component to visually represent the risk level with colors and text.
- Integrated the new component into the `EnhancedFileList` by adding a "Risk Level" column, making the AI-generated risk visible at a glance.

**Next Steps:**
- The final story in this epic will focus on building the detailed view to show the full analysis for a selected call.

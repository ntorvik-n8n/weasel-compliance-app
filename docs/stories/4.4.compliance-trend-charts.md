# Story 4.4: Compliance Trend Charts

## Story Overview

**Story ID:** 4.4
**Epic:** Epic 4 - Dashboard & Visualization
**Priority:** P2 (Medium)
**Status:** ⏸️ Deferred to v1.2 (POC Scope)
**Story Points:** 3
**Sprint:** Sprint 6 (Epic 4)
**Decision Date:** 2025-10-12
**Reason:** Requires multi-call aggregation beyond POC scope

## User Story
**As a** compliance manager
**I want** to see charts showing compliance trends over time
**So that** I can identify patterns, assess team performance, and track the impact of training.

## Technical Design
1.  **Install Charting Library:**
    -   Add `recharts` to the project's dependencies.
2.  **Create an API for Trend Data:**
    -   Create a new API route: `app/api/trends/route.ts`.
    -   This `GET` endpoint will be responsible for fetching aggregated data. For the initial implementation, it can read all analysis files, but in a real-world scenario, this would query a database.
    -   It should return data structured for the charts (e.g., an array of daily average risk scores for the last 30 days).
3.  **Create Chart Components:**
    -   Create a new directory: `components/dashboard/charts/`.
    -   **`RiskTrendChart.tsx`**: A line chart showing the average risk score per day for the last 30 days.
    -   **`ViolationDistributionChart.tsx`**: A bar chart showing the total count of each violation type.
    -   Each chart component will be responsible for fetching its own data from the `/api/trends` endpoint. They should handle their own loading and error states.
4.  **Integrate into Dashboard:**
    -   Add a new grid area to the `Dashboard.tsx` component for these charts.
    -   Render the new chart components within this area.

## Acceptance Criteria
- [ ] The `recharts` library is installed and configured.
- [ ] A new `GET /api/trends` endpoint provides aggregated data for visualizations.
- [ ] A line chart correctly displays the trend of average risk scores.
- [ ] A bar chart correctly displays the distribution of different violation types.
- [ ] Charts are integrated into the main dashboard layout.
- [ ] Charts have appropriate loading and error states.

## Deferral Analysis

### Why Deferred
Story 4.4 requires multi-call aggregation and trend analysis, which is beyond the POC scope that focuses on individual call analysis. Implementation requires:
- Database or efficient blob storage querying for multiple files
- Aggregation logic across time periods
- Additional API infrastructure
- Estimated 12-16 hours implementation time

### Current POC Status
The POC successfully demonstrates:
✅ Individual call analysis with risk scoring
✅ Violation detection and compliance checking
✅ Real-time AI-powered evaluation
✅ Rich UI for single-call insights

### Impact Assessment
- **Business Impact:** Low - Single-call analysis delivers core value proposition
- **User Impact:** Low - Users can analyze calls individually with full detail
- **Technical Debt:** None - Clean architecture supports future addition

### Recommendation for v1.2
When implementing Story 4.4:
1. Add database layer (Azure Cosmos DB or SQL Database)
2. Implement trend aggregation API (`/api/trends`)
3. Add Recharts library and create chart components:
   - RiskTrendChart.tsx (line chart, 30-day average risk scores)
   - ViolationDistributionChart.tsx (bar chart, violation types)
4. Integrate charts into dashboard grid
5. Estimated effort: 12-16 hours

### Alternative Approaches
- **Phase 1 (Quick win):** Simple list view of recent calls with inline risk scores
- **Phase 2 (Full charts):** Recharts implementation with trend analysis
- **Phase 3 (Advanced):** Agent performance comparison, custom date ranges

---
*Architect: Winston*
*Deferral Decision: Story Enhancement Pipeline (2025-10-12)*
*Recommendation: Implement in v1.2 after POC validation*

# Story 2.5: Recently Uploaded Section

## Story Overview

**Story ID:** 2.5
**Epic:** Epic 2 - Call Log Management System
**Priority:** P1 (High)
**Status:** Done
**Story Points:** 2
**Sprint:** Sprint 3 (Epic 2)

## User Story

**As a** compliance officer
**I want** to see a "Recently Uploaded" section showing my last few uploads
**So that** I can quickly access files I just uploaded without searching through the full list

## Background

Users frequently need to access files immediately after uploading them. A "Recently Uploaded" quick-access section in the sidebar provides immediate visibility and navigation to newly uploaded files, improving workflow efficiency.

## Acceptance Criteria

### Functional Requirements

1. **Recently Uploaded Widget**
   - [ ] Section displays in sidebar above or below file list
   - [ ] Shows last 5 uploaded files
   - [ ] Sorted by upload time (newest first)
   - [ ] Updates automatically when new file uploaded
   - [ ] Collapses/expands with toggle

2. **List Item Display**
   - [ ] Filename (truncated if long)
   - [ ] Upload timestamp (relative: "2 minutes ago")
   - [ ] Status badge (small version)
   - [ ] File size
   - [ ] Clickable to navigate to detail view

3. **Visual Design**
   - [ ] Distinct section header "Recently Uploaded"
   - [ ] Compact list items (smaller than main list)
   - [ ] Visual separator from other sidebar content
   - [ ] Fade-in animation when new file appears
   - [ ] "New" badge for files uploaded in last 5 minutes

4. **Empty State**
   - [ ] When no uploads: "No recent uploads"
   - [ ] Helpful message: "Upload a file to get started"
   - [ ] Not shown if list is empty

5. **Interactions**
   - [ ] Click file name navigates to detail view
   - [ ] Hover highlights item
   - [ ] Right-click shows context menu (optional)
   - [ ] Keyboard navigation (arrow keys)

6. **Time Display**
   - [ ] Relative time: "Just now", "2 minutes ago", "1 hour ago"
   - [ ] Switches to absolute time after 24 hours
   - [ ] Updates every minute
   - [ ] Tooltip shows full timestamp on hover

### Non-Functional Requirements

7. **Performance**
   - [ ] Updates instantly when file uploaded
   - [ ] No performance impact on main list
   - [ ] Smooth animations

8. **Persistence**
   - [ ] Recent uploads persist across page refreshes (session storage)
   - [ ] Clear on logout (optional)
   - [ ] Max 5 items stored

## Technical Design

### Component Structure

```typescript
// components/sidebar/RecentlyUploaded.tsx - New component

interface RecentlyUploadedProps {
  maxItems?: number;
  collapsible?: boolean;
}

export function RecentlyUploaded({ maxItems = 5, collapsible = true }: RecentlyUploadedProps) {
  const { state } = useFileManager();
  const [isExpanded, setIsExpanded] = useState(true);

  // Get last 5 uploads sorted by date
  const recentFiles = useMemo(() => {
    return [...state.files]
      .sort((a, b) => new Date(b.uploadedAt).getTime() - new Date(a.uploadedAt).getTime())
      .slice(0, maxItems);
  }, [state.files, maxItems]);

  if (recentFiles.length === 0) {
    return (
      <div className="p-4 text-center text-gray-500 text-sm">
        <p>No recent uploads</p>
        <p className="text-xs mt-1">Upload a file to get started</p>
      </div>
    );
  }

  return (
    <div className="border-b border-gray-200 pb-4">
      <div className="flex items-center justify-between px-4 py-2">
        <h3 className="text-sm font-semibold text-gray-700">
          Recently Uploaded
        </h3>
        {collapsible && (
          <button onClick={() => setIsExpanded(!isExpanded)}>
            {isExpanded ? <ChevronUpIcon /> : <ChevronDownIcon />}
          </button>
        )}
      </div>

      {isExpanded && (
        <ul className="space-y-1 px-2">
          {recentFiles.map(file => (
            <RecentFileItem key={file.name} file={file} />
          ))}
        </ul>
      )}
    </div>
  );
}
```

### Recent File Item Component

```typescript
// components/sidebar/RecentFileItem.tsx

interface RecentFileItemProps {
  file: FileMetadata;
}

export function RecentFileItem({ file }: RecentFileItemProps) {
  const router = useRouter();
  const uploadedRecently = isWithinMinutes(file.uploadedAt, 5);

  return (
    <li
      className="group flex items-start gap-2 p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors"
      onClick={() => router.push(`/calls/${encodeURIComponent(file.name)}`)}
    >
      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-2">
          <span className="text-sm font-medium text-gray-900 truncate">
            {file.name}
          </span>
          {uploadedRecently && (
            <Badge size="xs" color="blue">New</Badge>
          )}
        </div>

        <div className="flex items-center gap-2 mt-1">
          <StatusBadge status={file.status} size="xs" />
          <span className="text-xs text-gray-500">
            {formatFileSize(file.size)}
          </span>
          <span className="text-xs text-gray-500">•</span>
          <span className="text-xs text-gray-500" title={formatFullDate(file.uploadedAt)}>
            {formatRelativeTime(file.uploadedAt)}
          </span>
        </div>
      </div>
    </li>
  );
}
```

### Relative Time Formatter

```typescript
// lib/timeFormatting.ts - New utilities

export function formatRelativeTime(timestamp: string): string {
  const now = new Date();
  const then = new Date(timestamp);
  const diffMs = now.getTime() - then.getTime();
  const diffSec = Math.floor(diffMs / 1000);
  const diffMin = Math.floor(diffSec / 60);
  const diffHour = Math.floor(diffMin / 60);
  const diffDay = Math.floor(diffHour / 24);

  if (diffSec < 30) return 'Just now';
  if (diffMin < 1) return `${diffSec} seconds ago`;
  if (diffMin === 1) return '1 minute ago';
  if (diffMin < 60) return `${diffMin} minutes ago`;
  if (diffHour === 1) return '1 hour ago';
  if (diffHour < 24) return `${diffHour} hours ago`;
  if (diffDay === 1) return 'Yesterday';
  if (diffDay < 7) return `${diffDay} days ago`;

  // After 7 days, show absolute date
  return formatDate(timestamp);
}

export function isWithinMinutes(timestamp: string, minutes: number): boolean {
  const now = new Date();
  const then = new Date(timestamp);
  const diffMs = now.getTime() - then.getTime();
  return diffMs < minutes * 60 * 1000;
}

export function formatFullDate(timestamp: string): string {
  return new Date(timestamp).toLocaleString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
  });
}
```

### Auto-update Hook

```typescript
// hooks/useRelativeTime.ts - Auto-updating relative time

export function useRelativeTime(timestamp: string, updateInterval = 60000) {
  const [relativeTime, setRelativeTime] = useState(formatRelativeTime(timestamp));

  useEffect(() => {
    const timer = setInterval(() => {
      setRelativeTime(formatRelativeTime(timestamp));
    }, updateInterval);

    return () => clearInterval(timer);
  }, [timestamp, updateInterval]);

  return relativeTime;
}
```

### Sidebar Integration

```typescript
// components/sidebar/Sidebar.tsx - Updated

export function Sidebar() {
  return (
    <div className="w-80 bg-white border-l border-gray-200 flex flex-col h-screen">
      {/* Active Uploads (Epic 1) */}
      <div className="border-b border-gray-200">
        <ActiveUploads />
      </div>

      {/* Recently Uploaded (Story 2.5) */}
      <RecentlyUploaded />

      {/* Full File List (Story 2.1) */}
      <div className="flex-1 overflow-y-auto">
        <CallLogList compact={true} />
      </div>
    </div>
  );
}
```

## Dependencies

### External Dependencies
- None

### Internal Dependencies
- **Story 1.2:** File Upload Component (provides uploads)
- **Story 2.1:** Call Log List Display (file metadata)
- **Story 2.2:** File Selection (navigation)

### Blocking Dependencies
- None

## Testing Strategy

### Unit Tests
- [ ] `formatRelativeTime()` returns correct strings
- [ ] `isWithinMinutes()` calculates correctly
- [ ] Recent files sorted by date correctly

### Component Tests
- [ ] RecentlyUploaded shows correct number of files
- [ ] RecentFileItem displays all metadata
- [ ] Empty state shows when no files
- [ ] Click navigates to detail view

### Integration Tests
- [ ] New upload appears in recently uploaded
- [ ] List updates in real-time
- [ ] Time updates every minute

## Implementation Steps

1. **Create Time Formatting Utilities** (1 hour)
   - `formatRelativeTime()` function
   - `isWithinMinutes()` function
   - `formatFullDate()` function
   - Unit tests

2. **Create RecentFileItem Component** (1 hour)
   - Layout with metadata
   - Click handler for navigation
   - "New" badge logic
   - Hover states

3. **Create RecentlyUploaded Component** (2 hours)
   - Get recent files from context
   - Sort and limit to 5
   - Collapsible header
   - Empty state
   - Auto-update on new uploads

4. **Integrate with Sidebar** (1 hour)
   - Add to Sidebar component
   - Position above or below main list
   - Test layout

5. **Testing** (1 hour)
   - Unit tests
   - Component tests
   - Visual testing

**Total Estimate:** 1 day

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Recently uploaded section displays in sidebar
- [ ] Shows last 5 uploads
- [ ] Relative time formatting works
- [ ] "New" badges for recent files
- [ ] Click navigates to detail view
- [ ] Empty state implemented
- [ ] Unit tests passing
- [ ] Component tests passing
- [ ] Visual polish complete
- [ ] Code reviewed and approved

## Success Metrics

- Users access recent uploads within 2 clicks
- Recently uploaded section used by 80% of users
- Reduces search time for new files by 50%
- Rated helpful by 90% of users

## UI Reference

```
┌─────────────────────────────────┐
│ SIDEBAR                          │
├─────────────────────────────────┤
│ Active Uploads                   │
│ • chatlog5.json [====    ] 67%  │
├─────────────────────────────────┤
│ Recently Uploaded        [−]     │
├─────────────────────────────────┤
│ • chatlog4.json [New]            │
│   🟡 Processing • 2 MB           │
│   2 minutes ago                  │
├─────────────────────────────────┤
│ • chatlog3.json                  │
│   🟢 Analyzed • 1.5 MB           │
│   15 minutes ago                 │
├─────────────────────────────────┤
│ • chatlog2.json                  │
│   🟢 Analyzed • 1.8 MB           │
│   1 hour ago                     │
├─────────────────────────────────┤
│ All Call Logs (124)              │
│ [Search and filter...]           │
│ ...                              │
└─────────────────────────────────┘
```

## Related Documentation

- [Epic 2](../prd/epic-2-call-log-management.md) - Parent Epic
- [Story 2.1](./2.1.call-log-list-display.md) - List Display
- [Story 2.2](./2.2.file-selection-navigation.md) - Navigation

---

*Story created: 2025-10-11*
*Last updated: 2025-10-11*
*Product Owner: Sarah*
*Architect: Winston*

---

## QA Results

**Gate Status:** ✅ PASSED

**Reviewer:** Quinn (Test Architect)
**Date:** 2025-10-11

**Summary:**
The feature has now been fully implemented from scratch and meets all acceptance criteria. The new section appears correctly in the sidebar and displays the five most recently uploaded files.

**Actionable Items:**
- [x] Implement the `RecentlyUploaded.tsx` and `RecentFileItem.tsx` components.
- [x] Create the required time formatting utility functions.
- [x] Integrate the new section into the main `Sidebar.tsx` component.

**Full Report:** See [QA Gate Assessment](./../../qa/gates/2.5-recently-uploaded-section.yml)
